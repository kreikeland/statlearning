\PassOptionsToPackage{unicode=true}{hyperref} % options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
%
\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provides euro and other symbols
\else % if luatex or xelatex
  \usepackage{unicode-math}
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\usepackage{xcolor}
\usepackage{hyperref}
\hypersetup{
            pdftitle={Module 3: Recommended Exercises},
            pdfauthor={Michail Spitieris, Emma Skarstein, Stefanie Muff; Department of Mathematical Sciences, NTNU},
            colorlinks=true,
            linkcolor=Maroon,
            filecolor=Maroon,
            citecolor=Blue,
            urlcolor=blue,
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother

\title{Module 3: Recommended Exercises}
\providecommand{\subtitle}[1]{}
\subtitle{TMA4268 Statistical Learning V2021}
\author{Michail Spitieris, Emma Skarstein, Stefanie Muff \and Department of Mathematical Sciences, NTNU}
\date{January 26, 2021}

\begin{document}
\maketitle

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{We strongly recommend you to work through the Section 3.6 in the
course book (Lab on linear regression)}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{problem-1-extension-from-book-ex.-9}{%
\section{Problem 1 (Extension from Book Ex.
9)}\label{problem-1-extension-from-book-ex.-9}}

This question involves the use of multiple linear regression on the
\texttt{Auto} data set from \texttt{ISLR} package (you may use
\texttt{?Auto} to see a description of the data). First we exclude from
our analysis the variable \texttt{name} and look at the data summary and
structure of the dataset.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ISLR)}
\NormalTok{Auto =}\StringTok{ }\KeywordTok{subset}\NormalTok{(Auto, }\DataTypeTok{select =} \OperatorTok{-}\NormalTok{name)}
\CommentTok{# Auto$origin = factor(Auto$origin)}
\KeywordTok{summary}\NormalTok{(Auto)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       mpg          cylinders      displacement     horsepower   
##  Min.   : 9.00   Min.   :3.000   Min.   : 68.0   Min.   : 46.0  
##  1st Qu.:17.00   1st Qu.:4.000   1st Qu.:105.0   1st Qu.: 75.0  
##  Median :22.75   Median :4.000   Median :151.0   Median : 93.5  
##  Mean   :23.45   Mean   :5.472   Mean   :194.4   Mean   :104.5  
##  3rd Qu.:29.00   3rd Qu.:8.000   3rd Qu.:275.8   3rd Qu.:126.0  
##  Max.   :46.60   Max.   :8.000   Max.   :455.0   Max.   :230.0  
##      weight      acceleration        year           origin     
##  Min.   :1613   Min.   : 8.00   Min.   :70.00   Min.   :1.000  
##  1st Qu.:2225   1st Qu.:13.78   1st Qu.:73.00   1st Qu.:1.000  
##  Median :2804   Median :15.50   Median :76.00   Median :1.000  
##  Mean   :2978   Mean   :15.54   Mean   :75.98   Mean   :1.577  
##  3rd Qu.:3615   3rd Qu.:17.02   3rd Qu.:79.00   3rd Qu.:2.000  
##  Max.   :5140   Max.   :24.80   Max.   :82.00   Max.   :3.000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(Auto)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    392 obs. of  8 variables:
##  $ mpg         : num  18 15 18 16 17 15 14 14 14 15 ...
##  $ cylinders   : num  8 8 8 8 8 8 8 8 8 8 ...
##  $ displacement: num  307 350 318 304 302 429 454 440 455 390 ...
##  $ horsepower  : num  130 165 150 150 140 198 220 215 225 190 ...
##  $ weight      : num  3504 3693 3436 3433 3449 ...
##  $ acceleration: num  12 11.5 11 12 10.5 10 9 8.5 10 8.5 ...
##  $ year        : num  70 70 70 70 70 70 70 70 70 70 ...
##  $ origin      : num  1 1 1 1 1 1 1 1 1 1 ...
\end{verbatim}

We obtain a summary and see that all variables are numerical
(continuous). However, when we check the description of the data (again
with \texttt{?Auto}) we immediately see that \texttt{origin} is actually
encoding for either American (origin=1), European (origin=2) or
Janapense (origin=3) origin of the car, thus the values 1, 2 and 3 do
not have any actual numerical meaning. We therefore need to first change
the data type of that variable to let R know that we are dealing with a
qualitative (categorical) variable, instead of a continuous one
(otherwise we will obtain wrong model fits). In R such variables are
called \emph{factor variables}, and before we continue to do any
analyses we first need to convert \texttt{origin} into a factor variable
(a synonymous for ``qualitative predictor''):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Auto}\OperatorTok{$}\NormalTok{origin =}\StringTok{ }\KeywordTok{factor}\NormalTok{(Auto}\OperatorTok{$}\NormalTok{origin)}
\end{Highlighting}
\end{Shaded}

\hypertarget{a}{%
\subsection{a)}\label{a}}

Use the function \texttt{ggpairs()} from \texttt{GGally} package to
produce a scatterplot matrix which includes all of the variables in the
data set.

\hypertarget{b}{%
\subsection{b)}\label{b}}

Compute the correlation matrix between the variables. You will need to
remove the factor covariate \texttt{origin}, because this is no longer a
continuous variable.

\hypertarget{c}{%
\subsection{c)}\label{c}}

Use the \texttt{lm()} function to perform a multiple linear regression
with \texttt{mpg} (miles per gallon, a measure for fuel consumption) as
the response and all other variables (except \texttt{name}) as the
predictors. Use the \texttt{summary()} function to print the results.
Comment on the output. In particular:

\begin{enumerate}
\def\labelenumi{\roman{enumi}.}
\item
  Is there a relationship between the predictors and the response?
\item
  Is there evidence that the weight of a car influences \texttt{mpg}?
  Interpret the regression coefficient \(\beta_{\text{weight}}\) (what
  happens if a car weights 1000kg more, for example?).
\item
  What does the coefficient for the year variable suggest?
\end{enumerate}

\hypertarget{d}{%
\subsection{d)}\label{d}}

Look again at the regression output from question c). Now we want to
test whether the \texttt{origin} variable is important. How does this
work for a factor variable with more than only two levels?

\hypertarget{e}{%
\subsection{e)}\label{e}}

Use the \texttt{autoplot()} function from the \texttt{ggfortify} package
to produce diagnostic plots of the linear regression fit by setting
\texttt{smooth.colour\ =\ NA}, as sometimes the smoothed line can be
misleading. Comment on any problems you see with the fit. Do the
residual plots suggest any unusually large outliers? Does the leverage
plot identify any observations with unusually high leverage?

\hypertarget{f}{%
\subsection{f)}\label{f}}

For beginners, it can be difficult to decide whether a certain QQ plot
looks ``good'' or ``bad'', because we only look at it and do not test
anything. A way to get a feeling for how ``bad'' a QQ plot may look,
even when the normality assumption is perfectly ok, we can use
simulations: We can simply draw from the normal distribution and plot
the QQ plot. Use the following code to repeat this six times:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{2332}\NormalTok{)}
\NormalTok{n =}\StringTok{ }\DecValTok{100}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{6}\NormalTok{) \{}
\NormalTok{    sim =}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(n)}
    \KeywordTok{qqnorm}\NormalTok{(sim, }\DataTypeTok{pch =} \DecValTok{1}\NormalTok{, }\DataTypeTok{frame =} \OtherTok{FALSE}\NormalTok{)}
    \KeywordTok{qqline}\NormalTok{(sim, }\DataTypeTok{col =} \StringTok{"blue"}\NormalTok{, }\DataTypeTok{lwd =} \DecValTok{1}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{g}{%
\subsection{g)}\label{g}}

Let us look at interactions. These can be included via the \texttt{*} or
\texttt{:} symbols in the linear predictor of the regression function
(see Section 3.6.4 in the course book).

Fit another model for \texttt{mpg}, including only
\texttt{displacement}, \texttt{weight}, \texttt{year} and
\texttt{origin} as predictors, plus an interaction between \texttt{year}
and \texttt{origin} (interactions can be included as
\texttt{year*origin}; this adds the main effects and the interaction at
once). Is there evidence that the interactions term is relevant? Give an
interprentation of the result.

\hypertarget{h}{%
\subsection{h)}\label{h}}

Try a few different transformations of the variables, such as
\(\log(X),\) \(\sqrt{X},\) \(X^2\). See Section 3.6.5 in the course book
for how to do this. Perhaps you manage to improve the residual plots
that you got in e)? Comment on your findings.

\hypertarget{problem-2}{%
\section{Problem 2}\label{problem-2}}

\hypertarget{a-1}{%
\subsection{a)}\label{a-1}}

A core finding for the least-squares estimator
\(\hat{\boldsymbol\beta}\) of linear regression models is
\[ \hat{\boldsymbol\beta}=({\bf X}^T{\bf X})^{-1} {\bf X}^T {\bf Y} \ , \]
with
\(\hat{\boldsymbol\beta}\sim N_{p}(\boldsymbol\beta,\sigma^2({\bf X}^T{\bf X})^{-1})\).

\begin{itemize}
\tightlist
\item
  Show that \(\hat{\boldsymbol\beta}\) has this distribution with the
  given mean and covariance matrix.
\item
  What do you need to assume to get to this result?
\item
  What does this imply for the distribution of the \(j\)th element of
  \(\hat{\boldsymbol\beta}\)?
\item
  In particular, how can we calculate the variance of \(\hat{\beta}_j\)?
\end{itemize}

\hypertarget{b-1}{%
\subsection{b)}\label{b-1}}

What is the interpretation of a 95\% confidence interval? Hint: repeat
experiment (on \(Y\)), on average how many CIs cover the true
\(\beta_j\)? The following code shows an interpentation of a \(95\%\)
confidence interval. Study and fill in the code where is needed

\begin{itemize}
\tightlist
\item
  Model: \(Y = 1 + 3X + \varepsilon\), with
  \(\varepsilon \sim \mathsf{N}(0,1)\).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{beta0 =}\StringTok{ }\NormalTok{...}
\NormalTok{beta1 =}\StringTok{ }\NormalTok{...}
\NormalTok{true_beta =}\StringTok{ }\KeywordTok{c}\NormalTok{(beta0, beta1)  }\CommentTok{# vector of model coefficients}
\NormalTok{true_sd =}\StringTok{ }\DecValTok{1}  \CommentTok{# choosing true sd}
\NormalTok{X =}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)  }\CommentTok{# simulate the predictor variable X}
\NormalTok{Xmat =}\StringTok{ }\KeywordTok{model.matrix}\NormalTok{(}\OperatorTok{~}\NormalTok{X, }\DataTypeTok{data =} \KeywordTok{data.frame}\NormalTok{(X))  }\CommentTok{# create design matrix}


\NormalTok{ci_int =}\StringTok{ }\NormalTok{ci_x =}\StringTok{ }\DecValTok{0}  \CommentTok{# Counts how many times the true value is within the confidence interval}
\NormalTok{nsim =}\StringTok{ }\DecValTok{1000}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{nsim) \{}
\NormalTok{    y =}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DataTypeTok{n =} \DecValTok{100}\NormalTok{, }\DataTypeTok{mean =}\NormalTok{ Xmat }\OperatorTok{%*%}\StringTok{ }\NormalTok{true_beta, }\DataTypeTok{sd =} \KeywordTok{rep}\NormalTok{(true_sd, }\DecValTok{100}\NormalTok{))}
\NormalTok{    mod =}\StringTok{ }\KeywordTok{lm}\NormalTok{(y }\OperatorTok{~}\StringTok{ }\NormalTok{x, }\DataTypeTok{data =} \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ y, }\DataTypeTok{x =}\NormalTok{ X))}
\NormalTok{    ci =}\StringTok{ }\KeywordTok{confint}\NormalTok{(mod)}
\NormalTok{    ci_int[i] =}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(..., }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)  }\CommentTok{# if true value of beta0 is within the CI then 1 else 0}
\NormalTok{    ci_x[i] =}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(..., }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)  }\CommentTok{# if true value of beta_1 is within the CI then 1 else 0}
\NormalTok{\}}

\KeywordTok{c}\NormalTok{(}\KeywordTok{mean}\NormalTok{(ci_int), }\KeywordTok{mean}\NormalTok{(ci_x))}
\end{Highlighting}
\end{Shaded}

\hypertarget{c-1}{%
\subsection{c)}\label{c-1}}

What is the interpretation of a 95\% prediction interval? Hint: repeat
experiment (on \(Y\)) for a given \({\boldsymbol x}_0\). Write R code
that shows the interprentation of a 95\% PI. Hint: In order to produce
the PIs use the data point \(x_0 = 0.4.\) Furthermore you may use a
similar code structure as in b).

\hypertarget{d-1}{%
\subsection{d)}\label{d-1}}

Construct a 95\% CI for \({\boldsymbol x}_0^T \beta\). Explain what is
the connections between a CI for \(\beta_j\), a CI for
\({\boldsymbol x}_0^T \beta\) and a PI for \(Y\) at
\({\boldsymbol x}_0\).

\hypertarget{e-1}{%
\subsection{e)}\label{e-1}}

Explain the difference between \emph{error} and \emph{residual}. What
are the properties of the raw residuals? Why don't we want to use the
raw residuals for model check? What is our solution to this?

\end{document}
